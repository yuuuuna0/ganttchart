<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.weaverloft.ganttchart.mapper.MenuMapper">
<!--1. 상위메뉴 작성하기    -->
    <insert id="createMenu" parameterType="com.weaverloft.ganttchart.dto.Menu">
        <selectKey resultType="java.lang.Integer" keyProperty="menuNo" order="BEFORE">
            select MENU_MENU_NO_SEQ.nextval from dual
        </selectKey>
        insert into menu(menu_no,menu_order,menu_title,menu_url,menu_desc,parent_id,use_yn)
        values(#{menuNo},#{menuOrder},#{menuTitle},#{menuUrl},#{menuDesc},null,#{useYN})
    </insert>
<!-- 2. 상위메뉴 parentId 부여하기   -->
    <update id="updateParentId" parameterType="java.lang.Integer">
        update menu set PARENT_ID = #{menuNo} where MENU_NO=#{menuNo}
    </update>
    <!-- 5. 최근 값 불러오기 -->
    <select id="findCurMenuNo" resultType="java.lang.Integer">
        select MENU_MENU_NO_SEQ.currval from dual
    </select>
<!--1. 하위메뉴 작성하기    -->
    <insert id="createSubMenu" parameterType="com.weaverloft.ganttchart.dto.Menu">
        <selectKey resultType="java.lang.Integer" keyProperty="menuNo" order="BEFORE">
            select MENU_MENU_NO_SEQ.nextval from dual
        </selectKey>
        insert into menu(menu_no,menu_order,menu_title,menu_url,menu_desc,parent_id,use_yn)
        values(#{menuNo},#{menuOrder},#{menuTitle},#{menuUrl},#{menuDesc},#{parentId},#{useYN})
    </insert>
<!-- 2. 메뉴번호로 메뉴 찾기   -->
    <select id="findMenuByNo" parameterType="java.lang.Integer" resultType="com.weaverloft.ganttchart.dto.Menu">
        select * from MENU where MENU_NO=#{menuNo}
    </select>
<!-- 3. 메뉴 삭제하기   -->
    <delete id="deleteMenu" parameterType="java.lang.Integer">
        delete menu where MENU_NO=#{menuNo}
    </delete>
<!-- 4. 메뉴리스트 전체 불러오기   -->
    <select id="findMenuList" parameterType="java.util.Map" resultType="com.weaverloft.ganttchart.dto.Menu">
        select *
        from (select rownum idx, m.*
              from (select *
                    from menu
                    order by  MENU_NO asc ) m
                    where 1=1
                        <if test="keyword !=null">
                            and MENU_TITLE like '%'||#{keyword}||'%' or MENU_URL like '%'||#{keyword}||'%' or MENU_DESC like '%'||#{keyword}||'%'
                        </if>
            )
        <![CDATA[ where idx >= #{pageBegin} and idx <= #{pageEnd} ]]>
    </select>
<!-- 4-1. 하위메뉴 전체 불러오기   -->
    <select id="findSubMenuList" parameterType="java.lang.Integer" resultType="com.weaverloft.ganttchart.dto.Menu">
        select * from menu where PARENT_ID=#{menuNo}
    </select>
<!-- 4-2. 상위메뉴 전체 불러오기   -->
    <select id="findPreMenuList" resultType="com.weaverloft.ganttchart.dto.Menu">
        select * from menu where PARENT_ID = MENU_NO order by MENU_NO
    </select>
<!--  4-3. 메뉴리스트 전체 불러오기  -->
    <select id="findAllMenu" resultType="com.weaverloft.ganttchart.dto.Menu">
        select * from menu order by MENU_NO desc
    </select>
<!-- 5. 전체 메뉴 개수    -->
    <select id="findMenuCount" resultType="java.lang.Integer">
        select count(*) from menu where 1=1
        <if test="keyword !=null">
            and MENU_TITLE like '%'||#{keyword}||'%' or MENU_URL like '%'||#{keyword}||'%' or MENU_DESC like '%'||#{keyword}||'%'
        </if>
    </select>
<!-- 6. 메뉴 수정하기   -->
    <update id="updateMenu" parameterType="java.util.Map">
        update menu set MENU_ORDER=#{menuOrder},MENU_TITLE=#{menuTitle}, MENU_URL=#{menuUrl}, MENU_DESC=#{menuDesc}, USE_YN=#{useYN} where MENU_NO=#{menuNo}
    </update>
<!-- 6. 메뉴 사용여부 변경하기   -->
    <update id="updateUse" parameterType="java.util.Map">
        update menu set USE_YN=#{useYN} where MENU_NO=#{menuNo}
    </update>
<!--   메뉴이름 존재개수 -->
    <select id="isExistedMenuTitle" parameterType="java.lang.String" resultType="java.lang.Integer">
        select count(*) from menu where MENU_TITLE=#{menuTitle}
    </select>
<!--   메뉴url 존재여부 확인 -->
    <select id="isExistedMenuUrl" parameterType="java.lang.String" resultType="java.lang.Integer">
        select count(*) from menu where MENU_Url=#{menuUrl}
    </select>

</mapper>